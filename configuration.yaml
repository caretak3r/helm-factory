# =============================================================================
# Service Configuration Template
# =============================================================================
# This file is the single source of truth for your service's Helm chart.
# Configure the sections below to enable/disable features for your application.
# Most features are disabled by default - enable only what you need.
# =============================================================================

# -----------------------------------------------------------------------------
serviceName: ""
# name of the helm chart and service
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Platform specific
# -----------------------------------------------------------------------------
pipeline:
  libraryVersion: "0.0.1"
  # platform library chart version
  serviceVersion: "0.0.1"
  # service's version in the helm chart - will be used as the helm chart version as well 
  chartName: ""
  # by default will be the serviceName - only change this when you have multiple services

# -----------------------------------------------------------------------------
# Naming Configuration
# -----------------------------------------------------------------------------
# Override auto-generated names if needed
nameOverride: ""
fullnameOverride: ""

# -----------------------------------------------------------------------------
# Global Configuration
# -----------------------------------------------------------------------------
# Shared settings that apply across all resources and subcharts
global:
  # Docker registry for all images (can be overridden per-image)
  imageRegistry: ""
  # Global image pull policy: Always, IfNotPresent, Never
  imagePullPolicy: ""
  # Global image pull secrets (array of secret names)
  imagePullSecrets: []
  # Global storage class for PVCs
  storageClass: ""

# -----------------------------------------------------------------------------
# Workload Type Selection
# -----------------------------------------------------------------------------
# Choose ONE workload type for your application
# Options: Deployment (default), StatefulSet, DaemonSet
workload:
  type: Deployment

# -----------------------------------------------------------------------------
# Container Image Configuration
# -----------------------------------------------------------------------------
image:
  registry: docker.io
  repository: ""           # REQUIRED: e.g., myorg/myapp
  tag: "latest"           # REQUIRED: recommend using immutable tags
  digest: ""              # Optional: sha256:... overrides tag if set
  pullPolicy: IfNotPresent
  pullSecrets: []

# -----------------------------------------------------------------------------
# Replica Configuration
# -----------------------------------------------------------------------------
# Number of pod replicas (ignored when autoscaling is enabled)
replicaCount: 1
# Revision history limit for rollbacks
revisionHistoryLimit: 10

# -----------------------------------------------------------------------------
# Container Ports
# -----------------------------------------------------------------------------
# Ports exposed by the container
ports:
  - name: http
    containerPort: 8080
    protocol: TCP

# -----------------------------------------------------------------------------
# Service Configuration
# -----------------------------------------------------------------------------
service:
  enabled: false
  type: ClusterIP              # ClusterIP, NodePort, LoadBalancer, ExternalName
  ports:
    - name: http
      port: 80
      targetPort: http
      protocol: TCP
  # Session affinity: None, ClientIP
  sessionAffinity: None
  sessionAffinityConfig: {}
  clusterIP: ""
  loadBalancerIP: ""
  loadBalancerSourceRanges: []
  externalTrafficPolicy: Cluster
  annotations: {}

# -----------------------------------------------------------------------------
# High Availability Configuration
# -----------------------------------------------------------------------------
highAvailability:
  enabled: false
  # Pod anti-affinity preset: soft, hard (spreads pods across nodes)
  podAntiAffinityPreset: soft
  # Pod affinity preset: soft, hard
  podAffinityPreset: ""
  # Node affinity preset
  nodeAffinityPreset:
    type: ""              # soft, hard
    key: ""               # e.g., kubernetes.io/e2e-az-name
    values: []            # e.g., [e2e-az1, e2e-az2]
  # Topology spread constraints for zone/node distribution
  topologySpreadConstraints: []
  # Example:
  # topologySpreadConstraints:
  #   - maxSkew: 1
  #     topologyKey: topology.kubernetes.io/zone
  #     whenUnsatisfiable: DoNotSchedule
  #     labelSelector:
  #       matchLabels:
  #         app.kubernetes.io/instance: myapp

# -----------------------------------------------------------------------------
# Horizontal Pod Autoscaler
# -----------------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPU: 80              # Target CPU utilization percentage
  targetMemory: ""           # Target memory utilization percentage (optional)
  # Custom metrics for scaling
  metrics: []
  # Scaling behavior configuration
  behavior: {}
  # Example:
  # behavior:
  #   scaleDown:
  #     stabilizationWindowSeconds: 300
  #     policies:
  #       - type: Percent
  #         value: 10
  #         periodSeconds: 60
  #   scaleUp:
  #     stabilizationWindowSeconds: 0
  #     policies:
  #       - type: Percent
  #         value: 100
  #         periodSeconds: 15

# -----------------------------------------------------------------------------
# Update Strategy
# -----------------------------------------------------------------------------
updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 25%
    maxUnavailable: 25%

# -----------------------------------------------------------------------------
# Pod Disruption Budget
# -----------------------------------------------------------------------------
podDisruptionBudget:
  enabled: false
  # Specify ONE of minAvailable or maxUnavailable
  minAvailable: 1
  # maxUnavailable: 1

# -----------------------------------------------------------------------------
# Resource Configuration
# -----------------------------------------------------------------------------
resources: {}
# Example:
# resources:
#   requests:
#     cpu: 100m
#     memory: 128Mi
#   limits:
#     cpu: 500m
#     memory: 512Mi

# -----------------------------------------------------------------------------
# Probes Configuration
# -----------------------------------------------------------------------------
# Startup Probe - delays other probes until startup succeeds
startupProbe:
  enabled: false
  # httpGet, tcpSocket, exec, or grpc
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 1
  failureThreshold: 30
  successThreshold: 1

# Liveness Probe - restarts container if fails
livenessProbe:
  enabled: false
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Readiness Probe - removes from service if fails
readinessProbe:
  enabled: false
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# -----------------------------------------------------------------------------
# Init Containers
# -----------------------------------------------------------------------------
initContainers:
  enabled: false
  containers: []
  # Example:
  # containers:
  #   - name: init-db
  #     image: busybox:1.35
  #     command: ['sh', '-c', 'until nc -z db 5432; do sleep 1; done']
  #     resources:
  #       requests:
  #         cpu: 10m
  #         memory: 32Mi

# -----------------------------------------------------------------------------
# Sidecar Containers
# -----------------------------------------------------------------------------
sidecars:
  enabled: false
  containers: []
  # Example:
  # containers:
  #   - name: log-collector
  #     image: fluent/fluent-bit:2.0
  #     volumeMounts:
  #       - name: varlog
  #         mountPath: /var/log
  #     resources:
  #       requests:
  #         cpu: 50m
  #         memory: 64Mi

# -----------------------------------------------------------------------------
# ConfigMap Configuration
# -----------------------------------------------------------------------------
configMap:
  enabled: false
  # Mount the ConfigMap as a volume in the container
  mounted: false
  mountPath: /app/config
  subPath: ""
  # ConfigMap data (key-value pairs)
  data: {}
  # Example:
  # data:
  #   config.yaml: |
  #     server:
  #       port: 8080
  #   LOG_LEVEL: info
  annotations: {}
  labels: {}

# -----------------------------------------------------------------------------
# Secret Configuration
# -----------------------------------------------------------------------------
secret:
  enabled: false
  type: Opaque              # Opaque, kubernetes.io/tls, etc.
  # Base64 encoded data
  data: {}
  # Plain text data (will be encoded)
  stringData: {}
  annotations: {}
  labels: {}

# -----------------------------------------------------------------------------
# Environment Variables
# -----------------------------------------------------------------------------
# Direct environment variables
envVars: {}
# Example:
# envVars:
#   LOG_LEVEL: info
#   DATABASE_HOST: db.example.com
#   API_KEY:
#     valueFrom:
#       secretKeyRef:
#         name: api-secrets
#         key: api-key

# ConfigMap reference for env vars
envVarsConfigMap: ""
# Secret reference for env vars
envVarsSecret: ""

# -----------------------------------------------------------------------------
# Ingress Configuration
# -----------------------------------------------------------------------------
ingress:
  enabled: false
  ingressClassName: ""      # nginx, traefik, etc.
  hostname: app.local
  path: /
  pathType: ImplementationSpecific
  annotations: {}
  # Example for cert-manager:
  # annotations:
  #   cert-manager.io/cluster-issuer: letsencrypt-prod
  #   nginx.ingress.kubernetes.io/ssl-redirect: "true"
  tls: false
  # Use existing TLS secret
  existingSecret: ""
  # Generate self-signed certificate
  selfSigned: false
  # Additional hosts
  extraHosts: []
  # Example:
  # extraHosts:
  #   - name: api.example.com
  #     path: /
  extraPaths: []
  extraTls: []
  extraRules: []
  # Provide your own certificates
  secrets: []

# -----------------------------------------------------------------------------
# Gateway API Configuration (HTTPRoute / GRPCRoute)
# -----------------------------------------------------------------------------
# Modern replacement for Ingress using the Gateway API standard.
# Requires Gateway API CRDs installed in the cluster.
# Falls back to ingress.hostname/path when gateway-specific values not set.
gatewayApi:
  enabled: false
  # API version for all routes (can be overridden per-route)
  apiVersion: gateway.networking.k8s.io/v1
  # Default hostnames applied to all routes (falls back to ingress.hostname)
  hostnames: []
  # Default parentRefs applied to all routes — REQUIRED when any route is enabled
  parentRefs: []
  # Example:
  # parentRefs:
  #   - name: my-gateway
  #     namespace: gateway-system
  #     sectionName: https
  # Labels/annotations applied to all gateway routes
  labels: {}
  annotations: {}

  # HTTPRoute — standard HTTP/HTTPS routing
  httpRoute:
    enabled: false
    name: ""                    # Auto-generated: <fullname>-http
    apiVersion: ""              # Inherits from gatewayApi.apiVersion
    hostnames: []               # Inherits from gatewayApi.hostnames
    parentRefs: []              # Inherits from gatewayApi.parentRefs
    # Path matching rules (falls back to ingress.path/pathType)
    matches: []
    # Example:
    # matches:
    #   - path:
    #       type: PathPrefix
    #       value: /api
    # Request/response filters
    filters: []
    # Backend service references (defaults to this service)
    backendRefs: []
    # Complete rules override (replaces auto-generated rules)
    rules: []
    # Merge additional spec fields into the generated spec
    specOverrides: {}
    labels: {}
    annotations: {}

  # GRPCRoute — gRPC-specific routing
  grpcRoute:
    enabled: false
    name: ""                    # Auto-generated: <fullname>-grpc
    apiVersion: ""              # Inherits from gatewayApi.apiVersion
    hostnames: []               # Inherits from gatewayApi.hostnames
    parentRefs: []              # Inherits from gatewayApi.parentRefs
    # gRPC method/service matching
    matches: []
    # Backend service references (defaults to this service)
    backendRefs: []
    # Complete rules override
    rules: []
    # Merge additional spec fields
    specOverrides: {}
    labels: {}
    annotations: {}

# -----------------------------------------------------------------------------
# Certificate Management (cert-manager)
# -----------------------------------------------------------------------------
certificate:
  enabled: false
  issuer: ""               # ClusterIssuer name
  secretName: ""           # Will be auto-generated if not set
  duration: 2160h          # 90 days
  renewBefore: 360h        # 15 days
  dnsNames: []
  ipAddresses: []
  usages:
    - server auth
    - client auth

# -----------------------------------------------------------------------------
# TLS / Self-Signed Certificate Generation
# -----------------------------------------------------------------------------
# Generate self-signed TLS certificates
tlsSelfSigned:
  enabled: false
  commonName: ""
  dnsNames: []
  validityDays: 365

# -----------------------------------------------------------------------------
# mTLS Configuration
# -----------------------------------------------------------------------------
mtls:
  enabled: false
  policy: STRICT
  # Allowed SPIFFE principals for AuthorizationPolicy
  # Default wildcard allows all service accounts — restrict for zero-trust
  allowedPrincipals:
    - "cluster.local/ns/*/sa/*"

# -----------------------------------------------------------------------------
# Jobs Configuration (Pre-install / Post-install Helm Hooks)
# -----------------------------------------------------------------------------
jobs:
  # Common settings for all jobs
  image:
    repository: ""
    tag: "latest"
    pullPolicy: IfNotPresent
  backoffLimit: 3
  completions: 1
  parallelism: 1
  restartPolicy: Never
  activeDeadlineSeconds: 300
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Pre-install job (runs before main deployment)
  preInstall:
    enabled: false
    hookWeight: -5         # Lower = runs earlier
    # Inline script
    script: ""
    # Or reference a script file
    scriptFile: ""
    # Or custom command/args
    command: []
    args: []
    env: []
    volumeMounts: []
    volumes: []
    # Override common job settings
    # image: {}
    # resources: {}

  # Post-install job (runs after main deployment)
  postInstall:
    enabled: false
    hookWeight: 5          # Higher = runs later
    script: ""
    scriptFile: ""
    command: []
    args: []
    env: []
    volumeMounts: []
    volumes: []

# -----------------------------------------------------------------------------
# CronJob Configuration
# -----------------------------------------------------------------------------
cronJob:
  enabled: false
  schedule: "0 * * * *"    # Every hour
  concurrencyPolicy: Allow  # Allow, Forbid, Replace
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  startingDeadlineSeconds: 200
  suspend: false
  # Job template (inherits from jobs section by default)
  containers: []
  initContainers: []
  volumes: []
  annotations: {}
  podAnnotations: {}
  podLabels: {}
  nodeSelector: {}
  tolerations: []

# -----------------------------------------------------------------------------
# Persistence / Storage
# -----------------------------------------------------------------------------
persistence:
  enabled: false
  mountPath: /data
  subPath: ""
  storageClass: ""
  accessModes:
    - ReadWriteOnce
  size: 8Gi
  existingClaim: ""
  selector: {}
  dataSource: {}
  annotations: {}

# -----------------------------------------------------------------------------
# StatefulSet Specific Configuration
# -----------------------------------------------------------------------------
statefulSet:
  # Service name for stable network identities
  serviceName: ""
  # Pod management policy: OrderedReady, Parallel
  podManagementPolicy: OrderedReady
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      partition: 0
  # Volume claim templates for StatefulSet
  volumeClaimTemplates: []
  # Example:
  # volumeClaimTemplates:
  #   - name: data
  #     storageClassName: fast-ssd
  #     accessModes: [ReadWriteOnce]
  #     storage: 10Gi

# -----------------------------------------------------------------------------
# DaemonSet Specific Configuration
# -----------------------------------------------------------------------------
daemonSet:
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
  # DaemonSets often need specific node selectors
  nodeSelector: {}
  # Example:
  # nodeSelector:
  #   kubernetes.io/os: linux

# -----------------------------------------------------------------------------
# Service Account Configuration
# -----------------------------------------------------------------------------
serviceAccount:
  create: false
  name: ""
  automountServiceAccountToken: true
  annotations: {}
  # Example for AWS IAM roles:
  # annotations:
  #   eks.amazonaws.com/role-arn: arn:aws:iam::123456789:role/myapp
  labels: {}

# -----------------------------------------------------------------------------
# Security Context
# -----------------------------------------------------------------------------
# Pod-level security context
podSecurityContext:
  enabled: false
  fsGroup: 1001
  # runAsUser: 1001
  # runAsGroup: 1001
  # runAsNonRoot: true
  # seccompProfile:
  #   type: RuntimeDefault

# Container-level security context
containerSecurityContext:
  enabled: false
  runAsUser: 1001
  runAsNonRoot: true
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# -----------------------------------------------------------------------------
# Pod Scheduling
# -----------------------------------------------------------------------------
# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity (overrides HA presets if set)
affinity: {}

# Priority class name
priorityClassName: ""

# Scheduler name
schedulerName: ""

# Termination grace period
terminationGracePeriodSeconds: 30

# Pod restart policy (for non-controller pods)
podRestartPolicy: Always

# Host aliases (/etc/hosts entries)
hostAliases: []

# -----------------------------------------------------------------------------
# Volumes
# -----------------------------------------------------------------------------
extraVolumes: []
# Example:
# extraVolumes:
#   - name: config-vol
#     configMap:
#       name: my-config
#   - name: secret-vol
#     secret:
#       secretName: my-secret

extraVolumeMounts: []
# Example:
# extraVolumeMounts:
#   - name: config-vol
#     mountPath: /etc/config
#     readOnly: true

# -----------------------------------------------------------------------------
# Command and Args Override
# -----------------------------------------------------------------------------
command: []
args: []

# -----------------------------------------------------------------------------
# Lifecycle Hooks
# -----------------------------------------------------------------------------
lifecycleHooks: {}
# Example:
# lifecycleHooks:
#   postStart:
#     exec:
#       command: ["/bin/sh", "-c", "echo Hello"]
#   preStop:
#     httpGet:
#       path: /shutdown
#       port: 8080

# -----------------------------------------------------------------------------
# Service Monitor (Prometheus Operator)
# -----------------------------------------------------------------------------
serviceMonitor:
  enabled: false
  namespace: ""
  port: http
  path: /metrics
  interval: ""
  scrapeTimeout: ""
  labels: {}
  annotations: {}
  jobLabel: ""
  honorLabels: false
  relabelings: []
  metricRelabelings: []
  selector: {}
  namespaceSelector: {}

# -----------------------------------------------------------------------------
# Pod Monitor (Prometheus Operator)
# -----------------------------------------------------------------------------
podMonitor:
  enabled: false
  namespace: ""
  port: http
  path: /metrics
  interval: 30s
  scrapeTimeout: 10s
  labels: {}
  annotations: {}
  jobLabel: ""
  honorLabels: false
  relabelings: []
  metricRelabelings: []
  selector: {}
  namespaceSelector: {}

# -----------------------------------------------------------------------------
# Network Policy
# -----------------------------------------------------------------------------
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  podSelector: {}
  # Ingress rules
  ingress: []
  # Example:
  # ingress:
  #   - from:
  #       - namespaceSelector:
  #           matchLabels:
  #             name: ingress-nginx
  #     ports:
  #       - port: 8080
  # Egress rules
  egress: []

# -----------------------------------------------------------------------------
# Service Endpoints ConfigMap
# -----------------------------------------------------------------------------
# Creates a ConfigMap with service endpoint URLs for umbrella charts
serviceEndpoints:
  enabled: false

# -----------------------------------------------------------------------------
# Labels and Annotations
# -----------------------------------------------------------------------------
# Labels applied to all resources
commonLabels: {}

# Annotations applied to all resources
commonAnnotations: {}

# Labels for the workload (Deployment/StatefulSet/DaemonSet)
labels: {}

# Annotations for the workload
annotations: {}

# Labels for pods only
podLabels: {}

# Annotations for pods only
podAnnotations: {}
